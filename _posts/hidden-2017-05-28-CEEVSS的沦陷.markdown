---
layout: post
title: CEEVSS 的沦陷
date: 2017-05-28 18:42
categories: 作死志
tags: 作死 监控
---
当我们看到老王那“wangwang”的 Wi-Fi 密码，发出一连串的省略号时，谁也没有想到，这竟是拿下全国高考监控系统的第一把钥匙。

-------------------------

说来话长，那是 2016 年的 3 月。寒冬渐暖，但春风中尚余一丝凉意。

刚出院的我在家休养一周后返回学校，在一潭死水中无聊度日。于是乎，我开始寻找一些解闷的事。

我们学校的网络系统，别人如何看待我不知道，在我眼里，无异于一群狒狒在沙滩上搭成的城堡。远看还有几分浩浩荡荡，近看只是一堆石块沙砾的拙劣堆积。届时我已经拿到了学校核心交换机的管理权限，以及两台核心服务器的管理员密码。但令我最为向往的，还是学校的监控系统。

学校的监控系统，从入学起便是我的一块心结。老师用它威胁人，高考用它监视人，平常监控室老王用它逮上课玩手机的人。传说纷纭，不知道它究竟有何神通。

心比天高，可是无从入手。至今没有发现任何监控室的网络踪迹，除了在核心交换机上全局抓包时抓到了一些奇怪的视频数据：来自一个不存在的 IP，去往一个不存在的 IP，用的都是学校不存在的 192.168.0.0/16 网段。

迷茫与困惑。直到一天晚上我在学校所谓“计算机协会”这样一个死群里面遇到了 Haor，并顺着认识了 Zch。

或许是天命注定？

总之，我们使用了无线电测向、密码学爆破等一系列手段，日进了监控室名为 wang 的 AP。然后我还顺便学习了VLAN等交换技术。最终从学校的 VLAN 104 里找出了监控室的网中网，访问到了高考监控的主机。

虽说教室后面的监控似乎是与外网彻底断绝，但是教室前面的高考监控使用的是默认密码，十分舒爽地拿了下来。

监控主机是一家名为“佳发”的成都公司的上古产品，高考监控专用，网上找遍找不到客户端，除了一两个不小心流出的下载器。然而我分析了它使用的 Web 播放器控件，发现是基于大华公司的监控 SDK 开发的——自然 API 层面上兼容了。于是成功地用上了大华的 PC、手机客户端。我敢说，全校甚至全国都不会有别的人会用手机在线收看它的视频了。

遗憾的是，之后长达一年多的时间，监控方面都没有多少进展：除了把门卫室的监控分机拿了下来（并且证实之前在核心上抓到的视频数据是门卫室的监控发的），门卫室监控的主机、监控室监控的 PC 服务器都没有丝毫进展。

时间转瞬到了 2017 年的初春。又一个渐暖的寒冬，对于日穿老王一周年也没有什么纪念。

高考将至，我们说，还是搞一些事情吧。

搞就搞。这时监控室的 PC 主机已经换成了 Windows 7 系统，web 界面也高大上了起来。

秉承默认密码的宗旨，我在网上开始搜寻这套系统的默认密码。不出所料，在百度文库和某过期的 FTP 资源里找到了默认密码。一试，我了个去，进了。

这台服务器，运行着 Windows 7 系统，还是 32 位版的。这已经槽点满满了，然而更加令人无语的还在后面。

RDP 进去后，是一个全屏的控制界面，就像 KTV 里的点歌软件。没有任务栏，没有其他程序。看了下泄露出来的手册，需要按某个快捷键输入密码后才能唤出 CMD。

呃……我直接按了 Ctrl-Alt-End，唤出了任务管理器。

MDZZ。他们真的以为远程桌面里不能按 Ctrl-Alt-Del？好吧，Ctrl-Alt-End 在远程桌面里等效 Ctrl-Alt-Del 是一个生僻的知识点，然而作为开发者连这都不知道，滑天下之大稽。况且手机连 RDP 不就可以直接按 Ctrl-Alt-Del 了？

再说，那个管理密码也是默认的没改……

仔细研究后发现，这是一个分层的监控管理系统，我们学校的隶属于我们这里区级行政区的系统。然后一路向上，直到市、省、国家。

说实话，里面没啥新玩意。然而这个分级汇总系统引起了我们的兴趣：如此一层层地上去，不就到国家级了？虽然没什么奢望，但我们决定搞一把。

不出所料，区系统也是默认密码的鬼样。市系统躲在 NAT 防火墙后，逃过一劫。

不过路到这里就断了！每个节点只有上一层的 IP 地址，这要怎么找省级的 IP？

zmap 大法好。我 zmap 了全省的 IP，寻找这系统的特征端口，然后过滤去掉了黑洞防火墙，成功搞到一批极可能有漏洞的 IP。

但是还是很多……可能有上百个。但是没必要非要找省级的。我另外找了一个市级的日掉，成功拿到了省级的 IP。

省级虽然没有 RDP，然而有 VNC……也是默认密码。这个默认密码在网上当时已经找到的手册里没有，而是在区级的另一台电脑上找到的安装程序附送的文档里的。环环相扣啊。

省级拿下，国家级的 IP 自然拿到了。

会不会……也是默认密码？深呼吸，试了一下 IP。嗯，有 web，一试，不是默认密码。

可是一扫端口，有3306。然后一登——MLGB，默认密码！

于是得到了 web 用户的密码。于是国家级的高考监控系统就这么被拿下了。

笑死我了。滑天下之大稽。震惊！

可惜，只拖了库。等我找到 web 里的任意代码执行漏洞时，web 没有了，3306 限制了登录主机。只有 9902 还在。

可惜啊可惜，本来有望拿下国家级考试中心的~~（说不定还能拿到高考试卷）~~。

或许是网管终于发觉不对劲了吧。日志我删了的，被发现不太可能。不过国家中心本身就是在防火墙后面的，为什么他们的网管先前会把一个默认密码的 MySQL 数据手动映射到公网呢？不可思议，不得而知。

不过呢，还是可以等以后有空了，日出 9902 的二进制漏洞（如果有），拿下国家中心也未可知。

在高中阶段拖到了高考国家中心的监控系统的库，感觉，自己已经拿了一个终生成就了。虽然技术含量极低。

That's all. 从老王到天朝。这个故事仍未结束。
