---
layout: post
title: 逆向，PowerPC，假交换机
cover: /upload/2017/20170528174447.png
date: 2017-05-28 10:11
categories: IT杂记
tags: [PowerPC, 网络设备, 人生经验, 逆向]
---
吃一堑，长一智。但在这一堑咽下去之前，就是一副倒霉相。

前一阵氪了台带有 XGbps 带宽 CX4 口的交换机，本来打算的是买两台，作为猫房与 LCR 的核心交换机，把之前吃的两堑卖掉。于是先买了一台（还好！）来试水。

到手后略一研究发现，假的，都是假的。

![1]

 > 这台假三层交换机，所谓“赛天 X648GM”

假的倒不是它的万兆口子，那是实打实的 Infiniband 口，然而假的是……这是个假三层交换机啊……

经过对它所有串口菜单的 N 次遍历，以及 Web 界面的深挖细察，以及之后对它固件的逆向都证明，这就是一台活脱脱的二层交换机。三层？在三层的功能只有 QoS 和基于协议的 VLAN。

说好的 VLAN 接口呢？说好的路由接口呢？商品描述里写的清清楚楚的东西，全都是假的。不过买前卖家也告诉我这是他收购的，想来描述也是从它厂家官网复制的。

那么它厂家官网呢……一片暮气沉沉，似乎已经朝不保夕，濒临倒闭。没有固件更新，甚至连手册都没有，介绍只有和卖家宝贝描述里一样的寥寥数语（而且还在曰三层功能）。

不死心的我继续研究下去，终于在看到终端里输出的硬件信息时，发现……咋有些不对呢？

![2]

嗯，经过查证，没错，这东西根本不是啥“赛天 X648GM”，而是 Quanta LB4，一贴牌产品……

蛤，贴牌是吧。当时我还燃起了一点希望，你辣鸡赛天不管这机器，原厂商总要管吧。可事实是，这机子鬼才管……在网上痛苦地搜寻后（过程就不说了），发现几乎没有任何这家伙的信息。而名称相近的Quanta LB4M可以更新固件来实现三层功能，Quanta LB4G 甚至可以刷 Linux。可是 LB4……没有**任何**信息。

继续搜，总算找到了一些资料。可是我找到了什么呢……我前前后后找到了五个型号，都是这东西的贴牌品。而且，它们无一有固件更新……

悲催啊，为何都是假的啊。买的 H3C 7502 是假的 7602，Dell C2100 也是假的 OEM。

然后我做出了一个现在看起来非常错误的决定：试图把 LB4M 的固件魔改到 LB4 上。于是就有了下图的狼狈。

![3]

夭寿啊！我 x86 汇编都没日过，上来就日 PowerPC 啊！欲仙欲死啊！

这还只是冰山一角，我一共做了以下~~事~~无用功：

 - 试图破解它的固件升级 CRC 校验算法，来强刷进 LB4M 的固件：事实证明我还是 too young，玩不转汇编。
 - 试图在 qemu 的 PowerPC 架构模拟器中在线调试：一运行就报错。
 - 试图搞台 JTAG 设备在线调试：PowerPC 的 JTAG 设备动不动上千块……

好吧，我认怂，算你狠。

不过还是学到了一些东西：

 - PowerPC 汇编的基本语法，和逆向、汇编、IDA 的一点人生经验。
 - 发现了一个比较好的[在线反编译平台][4]，能把 PowerPC 的反编译到 C（虽然效果很挫，还有时间和大小限制）。
 - 知道了这个辣鸡系统是 Boardcom 的 FASTPATH，基于 VxWorks，很多背时机子都在用这个系统。
 - XModem 和 JTAG 很好玩的样子。
 - qemu 真的很慢。

吃一堑，长一智，现在我发现 Dell 的 Powerconnect 6248 可以扩展出 4 个 CX4 口，还是氪这台机子来做核心吧……至少是真三层！而且直到目前都还在支持状态，最新固件还是今年 4 月的。

眼前这贴牌机倒也不用甩卖了，至少可以放在接入层用，甩到 LCR 去。口子多，安逸。

  [1]: /upload/2017/20170528172533.png
  [2]: /upload/2017/20170528173749.png
  [3]: /upload/2017/20170528174447.png
  [4]: https://retdec.com/decompilation/
